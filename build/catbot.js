function addUser(e,t,r){db.serialize(function(){var o="INSERT INTO Customers (USERID, NAME, FRIENDLY) VALUES ('"+e+"', '"+t+"', "+r+")";db.run(o)})}function readUser(e){return db.serialize(function(){return db.run("SELECT * FROM tblUser WHERE USERID='"+e+"'")})}function formatUptime(e){var t="second";return e>60&&(e/=60,t="minute"),e>60&&(e/=60,t="hour"),1!=e&&(t+="s"),e=e+" "+t}function theBotHeardThat(e,t,r){e.api.reactions.add({timestamp:t.ts,channel:t.channel,name:r},function(t,r){t&&e.botkit.log("Failed to add emoji reaction :(",t)})}var fs=require("fs"),file="test.db",exists=fs.existsSync(file);exists||(console.log("Creating DB file."),fs.openSync(file,"w"));var sqlite3=require("sqlite3").verbose(),db=new sqlite3.Database(file);db.serialize(function(){exists||db.run("CREATE TABLE tblUser (USERID TEXT, NAME TEXT, FRIENDLY BOOL)")});var datamodule={addUser:addUser,readUser:readUser};module.exports={datamodule:datamodule};var Botkit=require("botkit"),database=require("datamodule"),controller=Botkit.slackbot({debug:!0}),feeling={happy:"smiley_cat",sad:"crying_cat_face",shocked:"scream_cat",pout:"pouting_cat",love:"heart_eyes_cat",cat:"cat2"},bot=controller.spawn({token:"xoxb-26876200608-6bw3bhhrdlBzelTms47UrpaE"}).startRTM();controller.hears(["hello","hi","hey"],"direct_message,direct_mention,mention",function(e,t){controller.storage.users.get(t.user,function(r,o){o&&o.friendly?(theBotHeardThat(e,t,feeling.happy),e.reply(t,"meow..?")):(theBotHeardThat(e,t,feeling.pout),e.reply(t,"mwwwaaa"))})}),controller.hears(["good cat","good kitty","good catbot"],["ambient"],function(e,t){theBotHeardThat(e,t,feeling.love),controller.storage.users.get(t.user,function(r,o){o||(o={id:t.user}),o.friendly=!0,controller.storage.users.save(o,function(r,o){e.reply(t,"Prrrrrrrr")})})}),controller.hears(["bad cat","bad kitty","bad catbot"],["ambient"],function(e,t){theBotHeardThat(e,t,feeling.shocked),controller.storage.users.get(t.user,function(r,o){o||(o={id:t.user}),o.friendly=!1,controller.storage.users.save(o,function(r,o){e.reply(t,"Hisssss")})})}),controller.hears(["call me (.*)"],["ambient"],function(e,t){var r=t.text.match(/call me (.*)/i),o=r[1];theBotHeardThat(e,t,feeling.cat),controller.storage.users.get(t.user,function(e,r){r||(r={id:t.user}),r.name=o,database.addUser(r.id,r.name,void 0!=r.friendly?r.friendly:!1),controller.storage.users.save(r,function(e,t){})})}),controller.hears(["report"],"direct_message,direct_mention,mention",function(e,t){}),controller.hears(["uptime","identify yourself","who are you","what is your name"],"direct_message,direct_mention,mention",function(e,t){theBotHeardThat(e,t,feeling.cat);var r=formatUptime(process.uptime());e.reply(t,":cat2: Meow Meow Meow (I am a bot named <@"+e.identity.name+">. I have been running for "+r+")")});